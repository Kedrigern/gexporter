
# Parsování souborů kxx

Jedná se o speciální formát Gordicu. Relevantní je soubor `uct`, kde je všechno. Tento soubor má v Černošicích za 3 měsíce (leden-březen 2016) 1 496 371 řádek. Čísla jsou zarovnána nulami.

## Rozbor struktury

1) Hledejme např. účetní výdaj `160110002`, vyskytuje na 3 místech exportovaného dokumentu `data/22,12,2016_uct.kxx`. Nejdřív od řádku 94878 k 94889, poté od řádku 138183 k 138194 a pak ještě jednou.

```
[keddie@localhost gexport]$ grep -n 1601100023 data/22,12,2016_uct.kxx
94879:G/$00015100001381601100023
94881:G/$00015100001381601100023
94883:G/$00015100001381601100023
94885:G/$00015100001381601100023
94887:G/#0002510000138*IC-47903783;*DIC-CZ47903783;*DICT-GORDIC spol. s r.o.;*EVK-KDF-20161601100023;
138184:G/$00011200002641601100023
138186:G/$00011200002641601100023
138188:G/$00011200002641601100023
138190:G/$00011200002641601100023
138192:G/#0002120000264*IC-47903783;*DIC-CZ47903783;*DICT-GORDIC spol. s r.o.;*EVK-KDF-20161601100023;
936903:G/@21480016011000231020100000000136100000000000200000007006171070000000000000000000080000 000000000000000000
936904:G/@21480016011000231020100006409518200000000000000000009000000000000000000000000000080000-000000000000000000
```

2) První sekce konkrétního výdaje vypadá následovně:

```
[keddie@localhost gexport]$ sed -n '94877,94890p' data/22,12,2016_uct.kxx
G/#0005510000137*DUD-00000001;
G/@19510000138000518030000000000000000000000000000000000000000000000000000000000003902206 000000000000000000
G/$00015100001381601100023
G/@19510000138000321000000000000000000000000000000000000000002016180002000000000000000000 000000000003902206
G/$00015100001381601100023
G/@19510000138000797051800000099000500000000000000000000000000000000000000000000003902206 000000000000000000
G/$00015100001381601100023
G/@19510000138000797032100000000075100004790378300000000000000000000000000000000000000000 000000000003902206
G/$00015100001381601100023
G/#0001510000138Smlouva GINIS 491/2012 MUCX - podpora SLA1 10-12/2015
G/#0002510000138*IC-47903783;*DIC-CZ47903783;*DICT-GORDIC spol. s r.o.;*EVK-KDF-20161601100023;
G/#0003510000138*EVKT-Smlouva GINIS 491/2012 MUCX - podpora SLA1 10-12/2015;*PID-MUCEP00457KB;
G/#0004510000138*DUD-00000001;
G/@19510000139000518030000000000000000000000000000000000000000000000000000000000002573428 000000000000000000
```
Jedná se o pouhé zaúčtování. Sekce končí pomocí řádku začínající `G/#` a obsahující `*DUD-`.

3) Druhá sekce obsahuje výrazně důležitější informace:

```
[keddie@localhost gexport]$ sed -n '138182,138195p' data/22,12,2016_uct.kxx
G/#0004120000263*DUD-00000001;
G/@03120000264000231030100006171516800000000000900000010006171100000001000000000000000000 000000000003902206
G/$00011200002641601100023
G/@03120000264000321000000000000000000000000000000000000000002016180002000000000003902206 000000000000000000
G/$00011200002641601100023
G/@03120000264000797023100000000085100004524478200000000000000000000000000000000000000000 000000000003902206
G/$00011200002641601100023
G/@03120000264000797032100000000070100004790378300000000000000000000000000000000003902206 000000000000000000
G/$00011200002641601100023
G/#0001120000264Smlouva GINIS 491/2012 MUCX - podpora SLA1 10-12/2015
G/#0002120000264*IC-47903783;*DIC-CZ47903783;*DICT-GORDIC spol. s r.o.;*EVK-KDF-20161601100023;
G/#0003120000264*EVKT-Smlouva GINIS 491/2012 MUCX - podpora SLA1 10-12/2015;*PID-MUCEP00457KB;
G/#0004120000264*DUD-00000001;
G/@03120000265000231030100006171516800000000000900000010006171100000001000000000000000000 000000000002573428
```

Z ní vybereme informace (1. řáděk):

```
G/@03120000264000231030100006171516800000000000900000010006171100000001000000000000000000 000000000003902206
```

Zbylé obdobné řádky jsou pohyby mezi účty (viz PDF finanční kontrola).

Poslední číslo je daný výdaj. Pokud je následován `-` (záporná hodnota) tak se jedná o vratku.

A nejdůležitější popisek:
```
G/#0001120000264Smlouva GINIS 491/2012 MUCX - podpora SLA1 10-12/2015
```

Hlavní řádek rozklíčujeme:

```
G/@01000000001000231000000006171516800000000000900000010006171100000001000000000000000000 000000000354300000
G/@01000000001000231000000000000111100000000000100000009006171090000000000000001390000000 000000000000000000
```

| Co                 | Délka |    1. řádek   |    2. řádek   |
|--------------------|------:|--------------:|--------------:|
| Paragraf           |   4   |          6171 |          0000 |
| Položka            |   4   |          5168 |          1111 |
| Záznamová jednotka |   3   |           000 |           000 |
| [Účelový znak][MFČR]|  9   |     000000009 |     000000001 |
| ORJ                |  10   |    0000001000 |    0000000900 |
| ORG                |  13   | 6171100000001 | 6171090000000 |
| Částka - má dáti   |  17+2 |          0.00 |  3,543,000.00 |
| Částka - dal       |  17+2 | 13,900,000.00 |          0.00 |

## Parsování

1. Projdu dokument, abych našel všechna **čísla dokladů** a rozsah řádků na kterém jsou
    - první na prvním řádku, zbylá za DUDem
    - ukončím jakmile se čísla dokladu začnou opakovat
    - sekce by měla mít 12-16 řádek (odhad)
2. Následně parsuji dle čísel dokladů
    - hlavní řádek
    - poznámku
3. Vyexportuji do CSV a zazipuji
    - id, para, polozka, zj, uz, orj, org, catska1, castka2, popis
4. Nyní mi již chybí jen číselník ORG a ORJ

[MFČR]: http://www.ucetni-portal.cz/ciselnik-ucelovych-znaku-1168-a.html
